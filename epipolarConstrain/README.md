# EpipolarConstrain——Designed by 叶培楚

**算法流程**

1. 读取图像；
2. 读取相机内参；
3. 提取图像特征点；
4. 特征匹配；
5. 利用经验法进行滤除错误匹配；
6. （利用RANSAC进一步过滤错误匹配）；
7. 对极几何约束计算相对变换；
8. 验证结果。


ps: 通过构建对极几何约束计算本质矩阵和基本矩阵并无差别，约束是一样的，差别在于点是归一化平面上的点还是像素平面上的点，对应的本质矩阵会需要乘上内参矩阵来得到基本矩阵。


**算法深入了解**

对极约束：
1. 对于有重叠纹理的两帧图像，通过特征点匹配可以找到一些匹配对，这是对极几何约束的基础;
2. 匹配对是由同一空间点在不同像素平面投影得到的不同像素坐标，以参考帧为基础，假设空间点为 $P_{w}$，参考帧投影像素为 $p_{r}$， 当前帧投影像素为 $p_{c}$。由于空间点 $P_{w}$ 深度值不确定，因此其可能在参考帧光心 $O_{r}$ 和投影像素 $p_{r}$ 射线上的任意一个位置。而射线上的 $P_{w}$ 与当前帧的光心 $O_{c}$ 的连线在当前帧像素平面的交点即为投影像素 $p_{r}$，因此很显然，$P_{w}, O_{r}, O_{c}, p_{r}, p_{c}$　五点共面。具体可以参考[对极几何、对极约束、单应性变换](https://blog.csdn.net/ak47fourier/article/details/82356771)。



在得到匹配对以后，需要进行运动估计。opencv提供了封装好的函数findEssentialMat，即本代码使用的。利用RANSAC方法剔除错误匹配； 
   

RANSAC剔除错误匹配的方式主要是：
 1. 首先随机选择一组点，八点法则需要8对匹配点，利用对极约束计算本质矩阵，计算本质矩阵的方法本代码有提供（EpipolarConstrainFor8Points）。
 2. 对本质矩阵进行SVD分解，得到四组可能的解，通过构建4个投影矩阵，将所有匹配对进行三角化和投影处理，统计点深度为正（即点在相机前方的）的点的数量，选择数量最多的一个投影矩阵为正确解，返回该解旋转矩阵和位移向量；
 3. 重复上述操作，直到最大迭代次数，或者内点数量达到阈值标准，最终得到解以及内点。


利用RANSAC的方法求解相机姿态，可以剔除错误匹配带来的误差影响。并且得到相机相对运动位姿的同时，还可以得到内点，优化匹配结果。



### 参考文献

1. [使用cv::findFundamentalMat要注意的几点](http://blog.sina.com.cn/s/blog_4298002e01013w9a.html)
2. [对极几何、对极约束、单应性变换](https://blog.csdn.net/ak47fourier/article/details/82356771)
3. [OpenCV中cv::recoverPose()函数详细介绍和用法，以及求解出的R,t的坐标相对关系](https://blog.csdn.net/u011341856/article/details/104116263?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task)
4. [相机位姿求解问题？](https://www.zhihu.com/question/51510464)