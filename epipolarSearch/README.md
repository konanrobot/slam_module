# EpipolarSearch—— Designed by 叶培楚

EpipolarSearch 函数是设计用来做极线搜索的。通过用类对函数的功能进行封装，提供必要的接口，供完成极线搜索任务。

**程序流程**

1. 读取图像和相机内参；
2. 对图像提取特征点；
3. 特征点匹配；
4. 利用匹配对计算本质矩阵；
5. 基于对极几何验证本质矩阵的误差；
6. 利用该本质矩阵恢复相机的相对运动；
7. 预设最大和最小深度，笔者这里采用逆深度的表示方法；（主要是由于采用逆深度表示，可以比较好的表达计算公式，不会那么容易造成数值太大）
8. 利用步骤7提供最大、最小深度值确定投影线段（极线）的起始点和终点；
9. 利用起始点和终点确定极线方向以及大小；
10. 对每个输入点在极线上计算NCC匹配分数；
11. 选择最优的NCC分数；
12. 根据自己所能容忍的匹配误差，选择阈值；
13. 返回匹配结果；
14. 构建特征点和匹配对，进行显示。

**简要介绍** 

前六个步骤是非常常规的操作，为了避免模块之间的耦合，我单独采用了OpenCV的函数进行实现。由于本文只需要一个相对位姿，因此为了减少不必要的麻烦，笔者就通过前面六个步骤在main函数中封装成一个函数，通过接口提供输入和得到输出，并将该输出作为极线搜索的输入，可以增加代码的阅读性。

实际上，利用极线搜索，那基本上可以确定我们是基于像素，或者说没有描述子的匹配方式了。而用前6个步骤显然是基于特征点法的操作。通常得到相对姿态这一步，我们是利用运动模型进行设置的。在直接法中，我们会用多个运动模型构建光度误差函数，通过最小化光度误差来优化运动位姿，最终得到一个粗略的位姿。

利用该位姿，我们可以进行极线搜索，找到最佳的匹配对。通过深度滤波来实现点的深度值估计。